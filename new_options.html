<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Editable Table</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    padding: 2rem;
    background: #f5f5f5;
  }
  .controls {
    margin-bottom: 1rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 0.75rem;
    text-align: left;
  }
  th {
    background: #f0f0f0;
  }
  tr:hover {
    background: #f9f9f9;
  }
  button {
    padding: 0.5rem 1rem;
    margin-right: 1rem;
    background-color: #007BFF;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  button.danger {
    background-color: #dc3545;
  }
  select, input[type="text"] {
    padding: 0.5rem;
    margin-right: 1rem;
  }
</style>
</head>
<body>

<div class="controls">
  <label for="colCount">Columns:</label>
  <select id="colCount">
    <option value="2">2</option>
    <option value="3" selected>3</option>
    <option value="4">4</option>
    <option value="5">5</option>
  </select>
  <button onclick="addRow()">Add Row</button>
  <input type="text" id="searchInput" placeholder="Search table..." />
  <div style="margin-bottom: 1rem;">
    <input type="file" id="importFile" accept=".json,.csv" />
  </div>

  <div style="margin-bottom: 1rem;">
    <button id="exportJsonBtn">Export JSON</button>
    <button id="exportCsvBtn">Export CSV</button>
  </div>

</div>

<table id="dataTable">
  <thead id="tableHead"></thead>
  <tbody id="tableBody"></tbody>
</table>

<script>

const STORAGE_KEY = 'editableTableData';

let tableData = [];
let columnCount = 3;

const colSelect = document.getElementById('colCount');
const tableHead = document.getElementById('tableHead');
const tableBody = document.getElementById('tableBody');
const searchInput = document.getElementById('searchInput');


searchInput.addEventListener('input', renderTable);

colSelect.addEventListener('change', () => {
  columnCount = parseInt(colSelect.value);
  tableData = tableData.map(row => row.slice(0, columnCount).concat(Array(columnCount).fill('')).slice(0, columnCount));
  saveData();
  renderTable();
});

function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify({ columnCount, tableData }));
}

function loadData() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    const parsed = JSON.parse(saved);
    columnCount = parsed.columnCount || 3;
    tableData = parsed.tableData || [];
    colSelect.value = columnCount;
  }
}

function addRow() {
  const newRow = Array(columnCount).fill('');
  tableData.unshift(newRow);
  saveData();
  renderTable();
}

function removeRow(index) {
  tableData.splice(index, 1);
  saveData();
  renderTable();
}

function renderTable() {
  // Render headers
  tableHead.innerHTML = '';
  const headRow = document.createElement('tr');
  for (let i = 0; i < columnCount; i++) {
    const th = document.createElement('th');
    th.textContent = `Column ${i + 1}`;
    headRow.appendChild(th);
  }
  const thRemove = document.createElement('th');
  thRemove.textContent = 'Remove';
  headRow.appendChild(thRemove);
  tableHead.appendChild(headRow);

  // Search filter
  const searchQuery = searchInput.value.toLowerCase();

  // Filter rows
  const filteredData = tableData.filter(row =>
    row.some(cell => cell.toLowerCase().includes(searchQuery))
  );

  // Render rows
  tableBody.innerHTML = '';
  filteredData.forEach((row, rowIndex) => {
    const tr = document.createElement('tr');
    row.forEach((cell, cellIndex) => {
      const td = document.createElement('td');
      const input = document.createElement('input');
      input.type = 'text';
      input.value = cell;
      input.style.width = '90%';
      input.oninput = (e) => {
        const globalIndex = tableData.indexOf(row);
        tableData[globalIndex][cellIndex] = e.target.value;
        saveData();
        // renderTable(); // Re-render to apply live search
      };
      td.appendChild(input);
      tr.appendChild(td);
    });
    const tdRemove = document.createElement('td');
    const btn = document.createElement('button');
    btn.textContent = '❌';
    btn.classList.add('danger');
    btn.onclick = () => {
      const globalIndex = tableData.indexOf(row);
      removeRow(globalIndex);
    };
    tdRemove.appendChild(btn);
    tr.appendChild(tdRemove);
    tableBody.appendChild(tr);
  });
}



// import from JSON or CSV
document.getElementById('importFile').addEventListener('change', handleImport);

function handleImport(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    const content = e.target.result;
    if (file.name.endsWith('.json')) {
      try {
        const data = JSON.parse(content);
        if (Array.isArray(data)) {
          tableData = data;
          renderTable();
          saveTableData();
        } else {
          alert('Invalid JSON format. Should be an array of rows.');
        }
      } catch (err) {
        alert('Failed to parse JSON.');
      }
    } else if (file.name.endsWith('.csv')) {
      const parsedData = parseCSV(content);
      tableData = parsedData;
      renderTable();
      saveTableData();
    } else {
      alert('Unsupported file type');
    }
  };
  reader.readAsText(file);
}

function parseCSV(csvText) {
  const lines = csvText.trim().split('\n');
  return lines.map(line => line.split(','));
}


// allow export / download into JSON or CSV

document.getElementById('exportJsonBtn').addEventListener('click', () => {
  const jsonData = JSON.stringify(tableData, null, 2);
  downloadFile('table-data.json', 'application/json', jsonData);
});

document.getElementById('exportCsvBtn').addEventListener('click', () => {
  const csvData = tableData.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
  downloadFile('table-data.csv', 'text/csv', csvData);
});

function downloadFile(filename, mimeType, content) {
  const blob = new Blob([content], { type: mimeType });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
}



// Initialize
loadData();
renderTable();
</script>
</body>
</html>
